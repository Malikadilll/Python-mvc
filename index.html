<!DOCTYPE html>
<html>
<script>
    let imageList = [Search for Students:format as text];
    let container = document.getElementById("studentList");
	let bkgImg = document.getElementById("background");
    
    console.log("test" + imageList);


    for (let i = 0; i < imageList.length; i++) {
        let newDiv = document.createElement("div");
        let newImg = document.createElement("img");
        let newName = document.createElement("p");
        let newScore = document.createElement("p");
        let imgSRC = ""
        let currentGameType = "Current page's Game's Type"

        if (currentGameType == "pool"){
            imgSRC = imageList[i].poolLink
            console.log("pool");
        } else if (currentGameType == "racecar") {
            imgSRC = imageList[i].carLink
            console.log("racecar");
        } else if (currentGameType == "plane") {
            imgSRC = imageList[i].planeLink
            console.log("plane");
        } else if (currentGameType == "underwater") {
            imgSRC = imageList[i].diverLink
            console.log("underwater");
        } else if (currentGameType == "balloon") {
            imgSRC = imageList[i].balloonLink
            console.log("balloon");
        }   
         
                     
        newDiv.classList.add("student");
        newName.innerText = imageList[i].name;
        newScore.innerText = imageList[i].score;
        newScore.style.color = "white";
        newScore.style.backgroundColor = "rgba(0, 0, 0, 0.5)";
        newScore.style.textAlign = "center";
        newScore.style.fontSize = "smaller";
        newScore.style.width = "65%";
        newScore.style.padding = "0 7px 7px 7px";
        newScore.style.margin = "auto";
        newScore.style.borderRadius = "0 0 10px 10px";
        newName.style.color = "white";
        newName.style.backgroundColor = "rgba(0, 0, 0, 0.5)";
        newName.style.textAlign = "center";
        newName.style.fontSize = "smaller";
        newName.style.width = "65%";
        newName.style.padding = "7px 7px 0 7px";
        newName.style.margin = "auto";
        newName.style.borderRadius = "10px 10px 0 0";
        newImg.src = imgSRC;
        newImg.height = 50;
        newImg.style.zIndex = 1
        newDiv.style.position = "absolute";
        newDiv.style.transitionDuration = '8s';
        newDiv.appendChild(newName);
        newDiv.appendChild(newScore);
        newDiv.appendChild(newImg);
        newDiv.style.top = `${i * 85}px`;
newDiv.style.left = '10px';
        newDiv.innerHTML += `<div class="tooltip">
                                <table>
<caption>Overall Grades</caption>
                                    <tr>
                                        <th>Subject</th>
                                        <th>Score</th>
                                    </tr>
                                    <tr>
                                        <td>${imageList[i].subject}</td>
                                        <td>${imageList[i].subjectScore}</td>
                                    </tr>
                                    <tr>
                                        <td>${imageList[i].subject2}</td>
                                        <td>${imageList[i].subject2Score}</td>
                                    </tr>
                                    <tr>
                                        <td>${imageList[i].subject3}</td>
                                        <td>${imageList[i].subject3Score}</td>
                                    </tr>
                                </table>
                            </div>`;
        container.appendChild(newDiv)
    }
    
    let backgroundImgHeight = `${((imageList.length + 1) * 85) + 20}px`;
    
    container.style.height = backgroundImgHeight;

	totalWidth = container.offsetWidth;

    let button = document.getElementById("sortButton");

    let maxScore = Current page's Game's End Points;

    let avatarMovement = Math.floor((totalWidth - 100) / maxScore);

    button.addEventListener("click", sortStudents);

    function sortStudents() {
        let currentGameType = document.getElementById("gameType").innerText.trim();
        let students = document.getElementsByClassName("student");
        console.log(students.length)
        for (let i = 0; i < students.length; i++) {
            let score = parseInt(students[i].getElementsByTagName("p")[1].innerHTML);
            if (score >= maxScore) {
                students[i].style.left = `${maxScore * avatarMovement}px`;
            } else {
                students[i].style.left = `${score * avatarMovement}px`;
            }
        }
    }
    function sortStudents() {
        let currentGameType = document.getElementById("gameType").innerText.trim();
    let students = document.getElementsByClassName("student");
    console.log(students.length);

    for (let i = 0; i < students.length; i++) {
        let score = parseInt(students[i].getElementsByTagName("p")[1].innerHTML);
        
        if (currentGameType == "pool"){
            if (score >= maxScore) {
                students[i].style.left = `${maxScore * avatarMovement}px`;
            } else {
                students[i].style.left = `${score * avatarMovement}px`;
            } 
        } else if (currentGameType == "racecar") {
            if (score >= maxScore) {
                students[i].style.left = `${maxScore * avatarMovement}px`;
            } else {
                students[i].style.left = `${score * avatarMovement}px`;
            }
        } else if (currentGameType == "plane") {
            if (score >= maxScore) {
                students[i].style.left = `${maxScore * avatarMovement}px`;
            } else {
                students[i].style.left = `${score * avatarMovement}px`;
            }
        } else if (currentGameType == "underwater") {
            if (score >= maxScore) {
                students[i].style.left = `${maxScore * avatarMovement}px`;
            } else {
                students[i].style.left = `${score * avatarMovement}px`;
            }  
        } else if (currentGameType == "balloon") {
             // Vertical movement (bottom to top)
             let maxHeight = container.offsetHeight - 100; // some buffer
            let avatarMovementY = Math.floor(maxHeight / maxScore);
            if (score >= maxScore) {
                students[i].style.top = `${container.offsetHeight - (maxScore * avatarMovementY)}px`;
            } else {
                students[i].style.top = `${container.offsetHeight - (score * avatarMovementY)}px`;
            }
        }   




    }
}

    
    let myDiv = document.getElementsByClassName("student");
    let tooltipVisible = false;

    function showTooltip(subject1, score1, subject2, score2, toolTipElement) {
        tooltipVisible = !tooltipVisible;

        if (tooltipVisible) {
            toolTipElement.style.opacity = 1;
            toolTipElement.style.visibility = 'visible';
            console.log("student div clicked visable true")
        } else {
            toolTipElement.style.opacity = 0;
            toolTipElement.style.visibility = 'hidden';
            console.log("student div clicked visable false")
        }
    }


    for (let i = 0; i < myDiv.length; i++) {
        const studentDiv = myDiv[i];
        let toolTip = studentDiv.lastChild;
        
        let subject1 = imageList[i].subject1;
        let subject2 = imageList[i].subject2;

        console.log(subject1);
        console.log(subject2);
        
        studentDiv.addEventListener("click", function () {
            showTooltip(subject1, 3, subject2, 5, toolTip)
        });

    }
    
    
    
</script>

<style>
    
    .student {
        position: absolute;
        z-index: 1;
    }

    .student .tooltip {
        position: absolute;
        top: -135px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #333;
        color: #fff;
        border-radius: 5px;
        font-size: 12px;
        padding: 5px;
        white-space: nowrap;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .student .tooltip div {
        padding: 3px;
        text-align: center;
        border: 1px solid white;
    }

    
    #studentList {
        position: relative;
        margin-Top: 50px;
        overflow: visible;
    }

    #background {
        position: absolute; 
        bottom: 0; 
        left: 0; 
        width: 100%
    }
  table {
    border-collapse: separate;
    border-spacing: 3px;
  }
  th, td {
    padding: 10px;
    text-align: center;
    border: 1px solid black;
  }
</style>

<body>
<div id="container">
    <div id="studentList">

    </div>

    <img src="Current page's Game's Cover's URL" id="background"></img>
  <button class="bubble-element Button clickable-element" id="sortButton"
    style="z-index: 15; align-self: center; min-width: 100%; max-width: 100%; order: 5; min-height: 45px; height: max-content; flex-grow: 0; flex-shrink: 0; width: 200px; margin: 0px; padding: 0px 20px; cursor: pointer; background: #0092E5; border: medium none; text-align: center; font-size: 12px; font-weight: 700; color: rgb(255, 255, 255); letter-spacing: 1px; line-height: 1; border-radius: 5px; box-shadow: none;">
    Play
</button>

<audio id="movementNoise" preload="auto">
    <source src="https://orangefreesounds.com/wp-content/uploads/2022/12/Large-crowd-cheering-sound-effect.mp3" type="audio/mp3">
</audio>

<script>
    document.getElementById('sortButton').addEventListener('click', function () {
        let movementNoise = document.getElementById('movementNoise');

        // Ensure the sound starts from the beginning every time
        movementNoise.currentTime = 0;
        movementNoise.play();

        // Stop sound after 8 seconds
        setTimeout(() => {
            movementNoise.pause();
            movementNoise.currentTime = 0;
        }, 8000); 
    });
</script>


