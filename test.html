<!DOCTYPE html>
<html>
<head>
    <style>
        .student {
            position: absolute;
            z-index: 1;
        }

        .student .tooltip {
            position: absolute;
            top: -135px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: #fff;
            border-radius: 5px;
            font-size: 12px;
            padding: 5px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        #studentList {
            position: relative;
            margin-top: 50px;
            overflow: visible;
        }

        #background {
            position: absolute; 
            bottom: 0; 
            left: 0; 
            width: 100%;
        }

        table {
            border-collapse: separate;
            border-spacing: 3px;
        }

        th, td {
            padding: 10px;
            text-align: center;
            border: 1px solid black;
        }

        button {
            z-index: 15;
            margin-top: 20px;
            padding: 10px 20px;
            background: #0092E5;
            color: white;
            font-weight: bold;
            border-radius: 5px;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div id="container">
    <div id="studentList"></div>
    <img src="racecar-background.jpg" id="background" />
    <button id="sortButton">Play</button>
</div>

<audio id="movementNoise" preload="auto">
    <source src="https://orangefreesounds.com/wp-content/uploads/2022/12/Large-crowd-cheering-sound-effect.mp3" type="audio/mp3">
</audio>

<script>
    // Mock data replacing "Search for Students:format as text"
    let imageList = [
        {
            name: "Alice",
            score: 7,
            poolLink: "pool1.png",
            carLink: "car1.png",
            planeLink: "plane1.png",
            diverLink: "diver1.png",
            balloonLink: "balloon1.png",
            subject: "Math",
            subjectScore: 95,
            subject2: "Science",
            subject2Score: 88,
            subject3: "English",
            subject3Score: 90,
            subject1: "History"
        },
        {
            name: "Bob",
            score: 10,
            poolLink: "pool2.png",
            carLink: "car2.png",
            planeLink: "plane2.png",
            diverLink: "diver2.png",
            balloonLink: "balloon2.png",
            subject: "Math",
            subjectScore: 78,
            subject2: "Science",
            subject2Score: 85,
            subject3: "English",
            subject3Score: 80,
            subject1: "History"
        }
    ];

    let container = document.getElementById("studentList");
    let bkgImg = document.getElementById("background");

    let currentGameType = "balloon";  // Replace Bubble value
    let maxScore = 10;                // Replace Bubble value

    console.log("test", imageList);

    for (let i = 0; i < imageList.length; i++) {
        let newDiv = document.createElement("div");
        let newImg = document.createElement("img");
        let newName = document.createElement("p");
        let newScore = document.createElement("p");
        let imgSRC = "";

        if (currentGameType == "pool") {
            imgSRC = imageList[i].poolLink;
        } else if (currentGameType == "racecar") {
            imgSRC = imageList[i].carLink;
        } else if (currentGameType == "plane") {
            imgSRC = imageList[i].planeLink;
        } else if (currentGameType == "underwater") {
            imgSRC = imageList[i].diverLink;
        } else if (currentGameType == "balloon") {
            imgSRC = imageList[i].balloonLink;
        }

        newDiv.classList.add("student");

        newName.innerText = imageList[i].name;
        newScore.innerText = imageList[i].score;

        newScore.style.cssText = `
            color: white;
            background-color: rgba(0, 0, 0, 0.5);
            text-align: center;
            font-size: smaller;
            width: 65%;
            padding: 0 7px 7px 7px;
            margin: auto;
            border-radius: 0 0 10px 10px;
        `;

        newName.style.cssText = `
            color: white;
            background-color: rgba(0, 0, 0, 0.5);
            text-align: center;
            font-size: smaller;
            width: 65%;
            padding: 7px 7px 0 7px;
            margin: auto;
            border-radius: 10px 10px 0 0;
        `;

        newImg.src = imgSRC;
        newImg.height = 50;
        newImg.style.zIndex = 1;

        newDiv.style.position = "absolute";
        newDiv.style.transitionDuration = '8s';
        newDiv.style.top = `${i * 85}px`;
        newDiv.style.left = '10px';

        newDiv.appendChild(newName);
        newDiv.appendChild(newScore);
        newDiv.appendChild(newImg);

        newDiv.innerHTML += `<div class="tooltip">
                                <table>
                                    <caption>Overall Grades</caption>
                                    <tr><th>Subject</th><th>Score</th></tr>
                                    <tr><td>${imageList[i].subject}</td><td>${imageList[i].subjectScore}</td></tr>
                                    <tr><td>${imageList[i].subject2}</td><td>${imageList[i].subject2Score}</td></tr>
                                    <tr><td>${imageList[i].subject3}</td><td>${imageList[i].subject3Score}</td></tr>
                                </table>
                            </div>`;

        container.appendChild(newDiv);
    }

    let backgroundImgHeight = `${((imageList.length + 1) * 85) + 20}px`;
    container.style.height = backgroundImgHeight;

    let totalWidth = container.offsetWidth;
    let avatarMovement = Math.floor((totalWidth - 100) / maxScore);

    let button = document.getElementById("sortButton");

    button.addEventListener("click", sortStudents);

    function sortStudents() {
        let students = document.getElementsByClassName("student");
        for (let i = 0; i < students.length; i++) {
            let score = parseInt(students[i].getElementsByTagName("p")[1].innerHTML);

            if (currentGameType === "balloon") {
                let maxHeight = container.offsetHeight - 100;
                let avatarMovementY = Math.floor(maxHeight / maxScore);
                students[i].style.top = `${container.offsetHeight - (score * avatarMovementY)}px`;
            } else {
                students[i].style.left = `${Math.min(score, maxScore) * avatarMovement}px`;
            }
        }
    }

    let myDiv = document.getElementsByClassName("student");
    let tooltipVisible = false;

    function showTooltip(subject1, score1, subject2, score2, toolTipElement) {
        tooltipVisible = !tooltipVisible;
        toolTipElement.style.opacity = tooltipVisible ? 1 : 0;
        toolTipElement.style.visibility = tooltipVisible ? 'visible' : 'hidden';
    }

    for (let i = 0; i < myDiv.length; i++) {
        const studentDiv = myDiv[i];
        let toolTip = studentDiv.lastChild;

        let subject1 = imageList[i].subject1;
        let subject2 = imageList[i].subject2;

        studentDiv.addEventListener("click", function () {
            showTooltip(subject1, 3, subject2, 5, toolTip)
        });
    }

    document.getElementById('sortButton').addEventListener('click', function () {
        let movementNoise = document.getElementById('movementNoise');
        movementNoise.currentTime = 0;
        movementNoise.play();

        setTimeout(() => {
            movementNoise.pause();
            movementNoise.currentTime = 0;
        }, 8000);
    });
</script>
</body>
</html>
